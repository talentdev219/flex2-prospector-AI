SELECT
esse.OCCURREDATDATEINT as occurred_date,
osse.PROPERTY_HS_SEQUENCE_ID AS sequence_id,
os.PROPERTY_HS_SEQUENCE_NAME AS sequence_name,
esse.PROPERTY_HS_SEQUENCE_STEP_ORDER as step_id,
osse.PROPERTY_HS_TEMPLATE_ID as template_id,
osse.PROPERTY_UNPARSED_HS_STEP_ENROLLMENT_ID AS sequence_enrollment_id,
esse.ID AS sequence_step_excution_id,
esse.OBJECTID AS contact_id,
oc.PROPERTY_FIRSTNAME AS contact_first_name,
oc.PROPERTY_LASTNAME AS contact_last_name,
oc.PROPERTY_UNPARSED_ASSOCIATEDCOMPANYID AS contact_company_id,
oc.PROPERTY_COMPANY AS contact_company_name,
osse.PROPERTY_HS_EMAIL_SENT_COUNT as sent_count,
osse.PROPERTY_UNPARSED_HS_EMAIL_REPLY_COUNT as reply_count,
osse.PROPERTY_UNPARSED_HS_EMAIL_OPEN_COUNT as open_count,
osse.PROPERTY_UNPARSED_HS_MEETING_BOOKED_COUNT as meeting_booked_count,
oc.UPDATEDAT AS contact_update_date,
-- oc.PROPERTY_ADDRESS AS contact_address,
oc.PROPERTY_CITY AS contact_city,
oc.PROPERTY_COMPANY AS contact_company,
oc.PROPERTY_COUNTRY AS contact_country,
oc.PROPERTY_CREATEDATE AS contact_create_date,
oc.PROPERTY_UNPARSED_CREATEDATE AS contact_create_timestamp,
oc.PROPERTY_EMAIL AS contact_eamil,
oc.PROPERTY_FIRST_DEAL_CREATED_DATE AS contact_first_deal_create_date,
oc.PROPERTY_HS_ADDITIONAL_EMAILS AS contact_additional_email,
oc.PROPERTY_HS_EMAIL_DOMAIN AS contact_email_domain,
oc.PROPERTY_HS_IP_TIMEZONE AS contact_ip_timezone,
oc.PROPERTY_HS_IS_UNWORKED AS contact_is_unworked,
oc.PROPERTY_HS_LATEST_SEQUENCE_ENDED_DATE AS contact_latest_sequence_ended_date,
oc.PROPERTY_UNPARSED_HS_LATEST_SEQUENCE_ENDED_DATE AS contact_latest_sequence_ended_timestamp,
oc.PROPERTY_HS_LATEST_SEQUENCE_ENROLLED_DATE AS contact_latest_sequence_enrolled_date,
oc.PROPERTY_UNPARSED_HS_LATEST_SEQUENCE_ENROLLED_DATE AS contact_latest_sequence_entrolled_timestamp,
oc.PROPERTY_HS_LEAD_STATUS AS contact_lead_status,
oc.PROPERTY_UNPARSED_HS_SEQUENCES_ENROLLED_COUNT AS contact_sequences_enrolled_count,
oc.PROPERTY_HS_SEQUENCES_IS_ENROLLED AS contact_sequences_is_enrolled,
oc.PROPERTY_UNPARSED_HS_TIME_BETWEEN_CONTACT_CREATION_AND_DEAL_CREATION AS contact_time_between_contact_creation_and_deal_creation,
oc.PROPERTY_HUBSPOT_OWNER_ID AS contact_hubspot_owner_id,
oc.PROPERTY_HUBSPOT_TEAM_ID AS contact_hubspot_team_id,
oc.PROPERTY_JOBTITLE AS contact_job_title,
oc.PROPERTY_LASTMODIFIEDDATE AS contact_last_modified_date,
oc.PROPERTY_UNPARSED_LASTMODIFIEDDATE AS contact_last_modifed_timestamp,
oc.PROPERTY_LEAD_SOURCE AS contact_lead_source,
oc.PROPERTY_LINKEDIN AS contact_linkedin,
oc.PROPERTY_MOBILEPHONE AS contact_mobile_phone,
oc.PROPERTY_UNPARSED_NUM_ASSOCIATED_DEALS AS contact_num_associated_deals,
oc.PROPERTY_UNPARSED_NUM_CONTACTED_NOTES AS contact_num_contacted_notes,
oc.PROPERTY_PHONE AS contact_phone,
oc.PROPERTY_STATE AS contact_state,
oc.PROPERTY_UNPARSED_UNITS AS contact_units,
oc.PROPERTY_WEBSITE AS contact_website,
oc.PROPERTY_ZIP AS contact_zipcode,
com.OBJECTTYPEID AS company_object_type_id,
com.UPDATEDAT AS company_update_date,
com.PROPERTY_ADDRESS AS company_address,
com.PROPERTY_ADDRESS2 AS company_address2,
com.PROPERTY_UNPARSED_ANNUALREVENUE AS company_annual_revenue,
com.PROPERTY_CITY AS company_city,
com.PROPERTY_COUNTRY AS company_country,
com.PROPERTY_CREATEDATE AS company_create_date,
com.PROPERTY_UNPARSED_CREATEDATE AS company_create_timestamp,
-- com.PROPERTY_DESCRIPTION AS company_description,
com.PROPERTY_DOMAIN AS company_domain,
com.PROPERTY_FACEBOOK_COMPANY_PAGE AS company_facebook_page,
com.PROPERTY_FIRST_CONTACT_CREATEDATE AS company_first_contact_date,
com.PROPERTY_FOUNDED_YEAR AS company_founded_year,
com.PROPERTY_HS_LEAD_STATUS AS company_lead_status,
com.PROPERTY_LINKEDIN_COMPANY_PAGE AS company_linkedin_page,
-- com.PROPERTY_LINKEDINBIO AS company_linkedin_bio,
com.PROPERTY_NAME AS company_name,
com.PROPERTY_UNPARSED_NUM_ASSOCIATED_CONTACTS AS company_num_associated_contacts,
com.PROPERTY_UNPARSED_NUM_ASSOCIATED_DEALS AS company_num_associated_deals,
com.PROPERTY_UNPARSED_NUMBER_OF_PROPERTIES AS company_num_properties,
com.PROPERTY_PHONE AS company_phone,
com.PROPERTY_PM_SOFTWARE AS company_pm_software,
com.PROPERTY_PORTFOLIO_SUBTYPE AS company_protfolio_subtype,
com.PROPERTY_PORTFOLIO_TYPE AS company_protfolio_type,
com.PROPERTY_RENT_PORTAL AS company_rent_portal,
com.PROPERTY_SEGMENT AS company_segment,
com.PROPERTY_STATE AS company_state,
com.PROPERTY_TIMEZONE AS company_timezone,
com.PROPERTY_UNPARSED_UNITS AS company_units,
com.PROPERTY_WEBSITE AS company_website,
com.PROPERTY_ZIP AS company_zipcode
FROM HUBSPOT_DB.V2_LIVE.OBJECTS_SEQUENCE_STEP_ENROLLMENTS osse
JOIN HUBSPOT_DB.V2_LIVE.EVENTS_V2_SEQUENCE_STEP_EXECUTED esse
ON osse.PROPERTY_UNPARSED_HS_STEP_ENROLLMENT_ID = SPLIT(esse.ID, '-')[2]
JOIN  HUBSPOT_DB.V2_LIVE.OBJECTS_SEQUENCES os
ON osse.PROPERTY_HS_SEQUENCE_ID = os.PROPERTY_UNPARSED_HS_SEQUENCE_ID
JOIN HUBSPOT_DB.V2_LIVE.OBJECTS_CONTACTS oc
ON esse.OBJECTID = oc.OBJECTID
JOIN  HUBSPOT_DB.V2_LIVE.OBJECTS_COMPANIES com
ON oc.PROPERTY_UNPARSED_ASSOCIATEDCOMPANYID = com.OBJECTID
WHERE esse.PROPERTY_HS_USER_FACING_ACTION_TYPE = 'AUTOMATED_EMAIL'
AND esse.OCCURREDATDATEINT >= 20230101
-- AND meeting_booked_count > 0